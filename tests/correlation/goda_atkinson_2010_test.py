#!/usr/bin/env python

import numpy as np

from openquake.hazardlib.imt import PGA, PGV, SA

import os.path
import sys

homedir = os.path.dirname(os.path.abspath(__file__))  # where is this script?
shakedir = os.path.abspath(os.path.join(homedir, '..', '..', '..'))
sys.path.insert(0, shakedir)

import shakelib.correlation.goda_atkinson_2010 as ga10


def test_goda_atkinson_2010():
    d = np.linspace(0, 10, 101)
    cor = ga10.GodaAtkinson2010.getSpatialCorrelation(d, PGA())
    cor_target = np.array(
        [1.,  0.60764951,  0.56794567,  0.54295775,  0.52439645,
         0.509507,  0.49701406,  0.48621708,  0.47668786,  0.46814459,
         0.4603915,  0.45328681,  0.4467244,  0.44062265,  0.43491741,
         0.42955732,  0.42450053,  0.41971254,  0.4151645,  0.41083208,
         0.40669453,  0.40273401,  0.39893507,  0.39528425,  0.39176972,
         0.38838106,  0.38510899,  0.38194529,  0.37888255,  0.37591413,
         0.37303405,  0.37023686,  0.36751764,  0.36487189,  0.3622955,
         0.35978469,  0.35733602,  0.35494627,  0.35261252,  0.35033203,
         0.34810227,  0.3459209,  0.34378573,  0.34169473,  0.33964599,
         0.33763772,  0.33566827,  0.33373606,  0.33183964,  0.3299776,
         0.32814866,  0.32635159,  0.32458521,  0.32284845,  0.32114025,
         0.31945964,  0.31780569,  0.3161775,  0.31457425,  0.31299513,
         0.31143938,  0.30990627,  0.30839512,  0.30690527,  0.30543609,
         0.30398698,  0.30255735,  0.30114668,  0.29975442,  0.29838007,
         0.29702315,  0.2956832,  0.29435977,  0.29305243,  0.29176078,
         0.29048441,  0.28922296,  0.28797604,  0.28674332,  0.28552445,
         0.28431911,  0.28312697,  0.28194774,  0.28078113,  0.27962684,
         0.27848461,  0.27735417,  0.27623526,  0.27512765,  0.27403108,
         0.27294533,  0.27187017,  0.27080539,  0.26975077,  0.26870612,
         0.26767123,  0.26664591,  0.26562997,  0.26462325,  0.26362555,
         0.26263671])
    np.testing.assert_allclose(cor, cor_target)

    cor = ga10.GodaAtkinson2010.getSpatialCorrelation(d, PGV())
    cor_target = np.array(
        [1.,  0.6424183,  0.60125347,  0.57508528,  0.55552415,
         0.5397597,  0.52648397,  0.51497559,  0.5047922,  0.49564186,
         0.48732128,  0.47968292,  0.47261612,  0.46603567,  0.45987446,
         0.45407866,  0.44860441,  0.44341544,  0.43848145,  0.43377681,
         0.42927965,  0.42497116,  0.42083503,  0.41685704,  0.41302468,
         0.4093269,  0.40575391,  0.40229695,  0.3989482,  0.39570059,
         0.39254777,  0.38948395,  0.3865039,  0.38360283,  0.38077635,
         0.37802046,  0.37533146,  0.37270596,  0.37014079,  0.36763307,
         0.36518007,  0.36277931,  0.36042843,  0.35812527,  0.35586777,
         0.35365404,  0.3514823,  0.34935086,  0.34725815,  0.34520268,
         0.34318307,  0.34119798,  0.33924618,  0.33732649,  0.33543779,
         0.33357903,  0.33174921,  0.32994737,  0.32817261,  0.32642407,
         0.32470094,  0.32300243,  0.3213278,  0.31967633,  0.31804736,
         0.31644024,  0.31485433,  0.31328906,  0.31174386,  0.31021817,
         0.30871148,  0.30722329,  0.30575312,  0.3043005,  0.302865,
         0.30144617,  0.30004363,  0.29865696,  0.29728579,  0.29592975,
         0.29458849,  0.29326167,  0.29194895,  0.29065003,  0.28936459,
         0.28809233,  0.28683297,  0.28558624,  0.28435186,  0.28312958,
         0.28191914,  0.2807203,  0.27953283,  0.27835649,  0.27719107,
         0.27603635,  0.27489213,  0.27375819,  0.27263435,  0.27152041,
         0.27041619])

    np.testing.assert_allclose(cor, cor_target)

    cor = ga10.GodaAtkinson2010.getSpatialCorrelation(d, SA(0.3))
    cor_target = np.array(
        [1.,  0.49694049,  0.4584153,  0.43461367,  0.41713909,
         0.40324156,  0.39166021,  0.38170752,  0.37296575,  0.36516139,
         0.35810527,  0.3516609,  0.34572647,  0.34022396,  0.3350922,
         0.33028234,  0.32575468,  0.32147658,  0.31742079,  0.31356438,
         0.30988782,  0.30637437,  0.30300955,  0.29978076,  0.29667695,
         0.29368838,  0.29080643,  0.28802343,  0.28533251,  0.28272751,
         0.28020286,  0.27775356,  0.27537502,  0.2730631,  0.27081401,
         0.26862427,  0.26649069,  0.26441034,  0.26238051,  0.26039869,
         0.25846257,  0.25656999,  0.25471896,  0.2529076,  0.25113419,
         0.24939708,  0.24769477,  0.24602581,  0.24438888,  0.24278272,
         0.24120612,  0.23965799,  0.23813727,  0.23664295,  0.2351741,
         0.23372983,  0.23230929,  0.23091168,  0.22953624,  0.22818225,
         0.22684901,  0.22553588,  0.22424222,  0.22296745,  0.221711,
         0.22047233,  0.21925091,  0.21804626,  0.2168579,  0.21568537,
         0.21452824,  0.21338609,  0.21225853,  0.21114517,  0.21004563,
         0.20895958,  0.20788666,  0.20682655,  0.20577893,  0.2047435,
         0.20371997,  0.20270805,  0.20170747,  0.20071798,  0.19973931,
         0.19877122,  0.19781348,  0.19686585,  0.19592813,  0.19500008,
         0.19408152,  0.19317222,  0.19227202,  0.19138071,  0.19049811,
         0.18962405,  0.18875836,  0.18790087,  0.18705142,  0.18620986,
         0.18537603])
    np.testing.assert_allclose(cor, cor_target)

    cor = ga10.GodaAtkinson2010.getSpatialCorrelation(d, SA(1.0))
    cor_target = np.array(
        [1.,  0.65630017,  0.61537561,  0.5892846,  0.5697452,
         0.55397682,  0.54068341,  0.52914935,  0.51893539,  0.50975143,
         0.5013953,  0.49372019,  0.48661595,  0.47999768,  0.47379851,
         0.46796478,  0.46245274,  0.45722622,  0.45225496,  0.44751337,
         0.44297963,  0.43863494,  0.43446301,  0.43044961,  0.42658225,
         0.42284987,  0.41924268,  0.41575193,  0.41236977,  0.40908916,
         0.4059037,  0.40280763,  0.39979569,  0.3968631,  0.39400545,
         0.39121874,  0.38849925,  0.38584359,  0.3832486,  0.38071136,
         0.37822916,  0.3757995,  0.37342001,  0.37108853,  0.368803,
         0.36656152,  0.36436229,  0.36220363,  0.36008395,  0.35800177,
         0.35595569,  0.35394439,  0.35196661,  0.35002116,  0.34810694,
         0.34622288,  0.34436797,  0.34254126,  0.34074184,  0.33896885,
         0.33722146,  0.3354989,  0.3338004,  0.33212527,  0.33047281,
         0.32884238,  0.32723335,  0.32564514,  0.32407715,  0.32252886,
         0.32099974,  0.31948927,  0.31799699,  0.31652241,  0.31506511,
         0.31362464,  0.3122006,  0.31079258,  0.30940021,  0.30802311,
         0.30666093,  0.30531333,  0.30397997,  0.30266054,  0.30135472,
         0.30006221,  0.29878274,  0.29751601,  0.29626176,  0.29501973,
         0.29378967,  0.29257132,  0.29136446,  0.29016885,  0.28898427,
         0.2878105,  0.28664733,  0.28549456,  0.284352,  0.28321945,
         0.28209671])
    np.testing.assert_allclose(cor, cor_target)

    cor = ga10.GodaAtkinson2010.getSpatialCorrelation(d, SA(3.0))
    cor_target = np.array(
        [1.,  0.84799507,  0.80875202,  0.78141459,  0.75978667,
         0.74162778,  0.72584064,  0.71179603,  0.69909559,  0.68746929,
         0.67672461,  0.66671892,  0.65734326,  0.64851226,  0.64015768,
         0.632224,  0.62466535,  0.61744336,  0.6105256,  0.60388431,
         0.59749561,  0.59133873,  0.5853955,  0.57964992,  0.57408783,
         0.5686966,  0.56346495,  0.55838275,  0.55344083,  0.54863091,
         0.54394544,  0.53937756,  0.53492098,  0.53056992,  0.52631908,
         0.52216356,  0.51809884,  0.51412072,  0.5102253,  0.50640898,
         0.50266836,  0.4990003,  0.49540184,  0.49187023,  0.48840286,
         0.4849973,  0.48165126,  0.47836258,  0.4751292,  0.47194922,
         0.4688208,  0.46574221,  0.46271183,  0.45972809,  0.45678953,
         0.45389474,  0.45104238,  0.44823119,  0.44545994,  0.44272749,
         0.44003273,  0.4373746,  0.43475209,  0.43216424,  0.42961011,
         0.42708883,  0.42459954,  0.42214143,  0.4197137,  0.41731561,
         0.41494643,  0.41260546,  0.41029204,  0.40800551,  0.40574526,
         0.40351068,  0.40130119,  0.39911624,  0.39695529,  0.39481781,
         0.3927033,  0.39061128,  0.38854127,  0.38649282,  0.38446548,
         0.38245884,  0.38047248,  0.37850599,  0.376559,  0.37463111,
         0.37272198,  0.37083123,  0.36895853,  0.36710355,  0.36526596,
         0.36344544,  0.3616417,  0.35985442,  0.35808332,  0.35632812,
         0.35458855])
    np.testing.assert_allclose(cor, cor_target)

    cor = ga10.GodaAtkinson2010.getSpatialCorrelation(d, SA(0.1))
    cor_target = np.array(
        [1.,  0.5980934,  0.55851077,  0.53364881,  0.51520435,
         0.50042237,  0.48802873,  0.4773241,  0.4678813,  0.45941935,
         0.45174316,  0.44471147,  0.43821861,  0.43218334,  0.42654183,
         0.42124295,  0.41624512,  0.411514,  0.40702093,  0.40274171,
         0.39865573,  0.39474528,  0.39099499,  0.38739151,  0.38392309,
         0.38057936,  0.37735115,  0.37423027,  0.37120938,  0.36828189,
         0.36544186,  0.3626839,  0.36000311,  0.35739504,  0.35485561,
         0.35238108,  0.34996802,  0.34761326,  0.34531389,  0.34306721,
         0.3408707,  0.33872204,  0.33661907,  0.33455976,  0.33254224,
         0.33056473,  0.3286256,  0.32672328,  0.32485631,  0.32302335,
         0.32122308,  0.3194543,  0.31771585,  0.31600666,  0.31432569,
         0.31267197,  0.31104459,  0.30944265,  0.30786534,  0.30631187,
         0.30478147,  0.30327343,  0.30178708,  0.30032175,  0.29887683,
         0.29745172,  0.29604585,  0.29465869,  0.2932897,  0.2919384,
         0.29060429,  0.28928694,  0.28798588,  0.28670071,  0.28543101,
         0.2841764,  0.2829365,  0.28171095,  0.2804994,  0.27930151,
         0.27811697,  0.27694546,  0.27578667,  0.27464033,  0.27350615,
         0.27238386,  0.2712732,  0.27017392,  0.26908577,  0.26800851,
         0.26694192,  0.26588577,  0.26483986,  0.26380396,  0.26277789,
         0.26176145,  0.26075444,  0.25975668,  0.258768,  0.25778821,
         0.25681717])
    np.testing.assert_allclose(cor, cor_target)

    cor = ga10.GodaAtkinson2010.getSpatialCorrelation(d, SA(0.2))
    cor_target = np.array(
        [1.,  0.55054709,  0.51114686,  0.48659977,  0.46848234,
         0.45401738,  0.44192595,  0.43150836,  0.4223383,  0.41413601,
         0.40670762,  0.39991299,  0.39364745,  0.38783063,  0.38239948,
         0.37730355,  0.37250183,  0.36796053,  0.36365144,  0.35955079,
         0.35563833,  0.35189667,  0.34831076,  0.3448675,  0.34155539,
         0.3383643,  0.33528524,  0.3323102,  0.32943204,  0.32664431,
         0.32394121,  0.32131749,  0.31876837,  0.31628952,  0.31387697,
         0.31152707,  0.30923648,  0.30700214,  0.30482119,  0.30269102,
         0.3006092,  0.29857346,  0.2965817,  0.29463196,  0.29272242,
         0.29085136,  0.28901718,  0.28721839,  0.28545358,  0.2837214,
         0.28202063,  0.28035008,  0.27870863,  0.27709525,  0.27550894,
         0.27394876,  0.27241381,  0.27090325,  0.26941628,  0.26795214,
         0.26651009,  0.26508945,  0.26368956,  0.26230979,  0.26094954,
         0.25960823,  0.25828532,  0.25698029,  0.25569263,  0.25442187,
         0.25316754,  0.2519292,  0.25070643,  0.24949882,  0.24830598,
         0.24712754,  0.24596313,  0.24481241,  0.24367504,  0.2425507,
         0.24143909,  0.24033989,  0.23925282,  0.23817761,  0.23711399,
         0.23606169,  0.23502046,  0.23399007,  0.23297027,  0.23196084,
         0.23096157,  0.22997223,  0.22899263,  0.22802256,  0.22706183,
         0.22611025,  0.22516765,  0.22423384,  0.22330865,  0.22239192,
         0.2214835])
    np.testing.assert_allclose(cor, cor_target)

    cor = ga10.GodaAtkinson2010.getSpatialCorrelation(d, SA(0.5))
    cor_target = np.array(
        [1.,  0.55054709,  0.51114686,  0.48659977,  0.46848234,
         0.45401738,  0.44192595,  0.43150836,  0.4223383,  0.41413601,
         0.40670762,  0.39991299,  0.39364745,  0.38783063,  0.38239948,
         0.37730355,  0.37250183,  0.36796053,  0.36365144,  0.35955079,
         0.35563833,  0.35189667,  0.34831076,  0.3448675,  0.34155539,
         0.3383643,  0.33528524,  0.3323102,  0.32943204,  0.32664431,
         0.32394121,  0.32131749,  0.31876837,  0.31628952,  0.31387697,
         0.31152707,  0.30923648,  0.30700214,  0.30482119,  0.30269102,
         0.3006092,  0.29857346,  0.2965817,  0.29463196,  0.29272242,
         0.29085136,  0.28901718,  0.28721839,  0.28545358,  0.2837214,
         0.28202063,  0.28035008,  0.27870863,  0.27709525,  0.27550894,
         0.27394876,  0.27241381,  0.27090325,  0.26941628,  0.26795214,
         0.26651009,  0.26508945,  0.26368956,  0.26230979,  0.26094954,
         0.25960823,  0.25828532,  0.25698029,  0.25569263,  0.25442187,
         0.25316754,  0.2519292,  0.25070643,  0.24949882,  0.24830598,
         0.24712754,  0.24596313,  0.24481241,  0.24367504,  0.2425507,
         0.24143909,  0.24033989,  0.23925282,  0.23817761,  0.23711399,
         0.23606169,  0.23502046,  0.23399007,  0.23297027,  0.23196084,
         0.23096157,  0.22997223,  0.22899263,  0.22802256,  0.22706183,
         0.22611025,  0.22516765,  0.22423384,  0.22330865,  0.22239192,
         0.2214835])
    np.testing.assert_allclose(cor, cor_target)

    cor = ga10.GodaAtkinson2010.getSpatialCorrelation(d, SA(2.0))
    cor_target = np.array(
        [1.,  0.73652652,  0.69573199,  0.6690968,  0.64885195,
         0.63233738,  0.61829698,  0.60603033,  0.59510401,  0.58522986,
         0.57620587,  0.56788459,  0.56015486,  0.55293069,  0.54614405,
         0.53974017,  0.53367426,  0.52790916,  0.52241371,  0.51716149,
         0.5121299,  0.50729944,  0.50265316,  0.49817623,  0.4938556,
         0.48967972,  0.4856383,  0.48172217,  0.47792306,  0.47423355,
         0.47064691,  0.46715703,  0.46375834,  0.46044578,  0.45721468,
         0.45406076,  0.4509801,  0.44796905,  0.44502427,  0.44214261,
         0.43932121,  0.43655735,  0.43384854,  0.43119242,  0.4285868,
         0.42602962,  0.42351896,  0.421053,  0.41863005,  0.41624848,
         0.4139068,  0.41160356,  0.40933742,  0.40710709,  0.40491137,
         0.40274909,  0.40061918,  0.39852058,  0.39645232,  0.39441346,
         0.39240309,  0.39042037,  0.38846448,  0.38653464,  0.38463011,
         0.38275018,  0.38089416,  0.3790614,  0.37725129,  0.37546321,
         0.3736966,  0.3719509,  0.37022559,  0.36852014,  0.36683408,
         0.36516693,  0.36351823,  0.36188755,  0.36027446,  0.35867857,
         0.35709947,  0.35553679,  0.35399016,  0.35245923,  0.35094366,
         0.34944312,  0.34795729,  0.34648585,  0.34502852,  0.34358501,
         0.34215502,  0.3407383,  0.33933457,  0.33794359,  0.3365651,
         0.33519887,  0.33384466,  0.33250225,  0.33117141,  0.32985193,
         0.32854361])
    np.testing.assert_allclose(cor, cor_target)

    cor = ga10.GodaAtkinson2010.getSpatialCorrelation(d, SA(5.0))
    cor_target = np.array(
        [1.,  0.87597688,  0.84000832,  0.81442353,  0.79390557,
         0.77650229,  0.76124767,  0.74758333,  0.73515341,  0.72371535,
         0.71309537,  0.70316415,  0.6938225,  0.68499244,  0.67661142,
         0.66862839,  0.66100107,  0.65369398,  0.64667703,  0.63992448,
         0.63341404,  0.62712635,  0.62104441,  0.61515323,  0.6094395,
         0.60389136,  0.59849816,  0.59325035,  0.58813925,  0.58315702,
         0.57829651,  0.57355118,  0.56891506,  0.56438264,  0.55994887,
         0.55560906,  0.55135888,  0.54719432,  0.54311164,  0.53910736,
         0.53517824,  0.53132124,  0.52753352,  0.5238124,  0.52015539,
         0.51656012,  0.51302438,  0.50954608,  0.50612322,  0.50275394,
         0.49943648,  0.49616914,  0.49295033,  0.48977855,  0.48665234,
         0.48357035,  0.48053126,  0.47753384,  0.47457688,  0.47165927,
         0.46877991,  0.46593777,  0.46313185,  0.46036121,  0.45762493,
         0.45492214,  0.452252,  0.4496137,  0.44700647,  0.44442957,
         0.44188227,  0.43936389,  0.43687375,  0.43441123,  0.43197571,
         0.42956658,  0.42718327,  0.42482523,  0.42249192,  0.42018282,
         0.41789743,  0.41563526,  0.41339585,  0.41117874,  0.40898349,
         0.40680967,  0.40465687,  0.40252469,  0.40041274,  0.39832065,
         0.39624804,  0.39419456,  0.39215986,  0.39014361,  0.38814549,
         0.38616517,  0.38420235,  0.38225673,  0.38032801,  0.37841591,
         0.37652016])
    np.testing.assert_allclose(cor, cor_target)

    # Undefined:
    cor = ga10.GodaAtkinson2010.getSpatialCorrelation(d, 'PGD')
    cor_target = np.array(
        [1.,  0.6424183,  0.60125347,  0.57508528,  0.55552415,
         0.5397597,  0.52648397,  0.51497559,  0.5047922,  0.49564186,
         0.48732128,  0.47968292,  0.47261612,  0.46603567,  0.45987446,
         0.45407866,  0.44860441,  0.44341544,  0.43848145,  0.43377681,
         0.42927965,  0.42497116,  0.42083503,  0.41685704,  0.41302468,
         0.4093269,  0.40575391,  0.40229695,  0.3989482,  0.39570059,
         0.39254777,  0.38948395,  0.3865039,  0.38360283,  0.38077635,
         0.37802046,  0.37533146,  0.37270596,  0.37014079,  0.36763307,
         0.36518007,  0.36277931,  0.36042843,  0.35812527,  0.35586777,
         0.35365404,  0.3514823,  0.34935086,  0.34725815,  0.34520268,
         0.34318307,  0.34119798,  0.33924618,  0.33732649,  0.33543779,
         0.33357903,  0.33174921,  0.32994737,  0.32817261,  0.32642407,
         0.32470094,  0.32300243,  0.3213278,  0.31967633,  0.31804736,
         0.31644024,  0.31485433,  0.31328906,  0.31174386,  0.31021817,
         0.30871148,  0.30722329,  0.30575312,  0.3043005,  0.302865,
         0.30144617,  0.30004363,  0.29865696,  0.29728579,  0.29592975,
         0.29458849,  0.29326167,  0.29194895,  0.29065003,  0.28936459,
         0.28809233,  0.28683297,  0.28558624,  0.28435186,  0.28312958,
         0.28191914,  0.2807203,  0.27953283,  0.27835649,  0.27719107,
         0.27603635,  0.27489213,  0.27375819,  0.27263435,  0.27152041,
         0.27041619])
    np.testing.assert_allclose(cor, cor_target)


if __name__ == '__main__':
    test_goda_atkinson_2010()
